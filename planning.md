# Australian Health & Dietary Trends: Project Plan

## Project Overview

This project investigates the relationship between seed oil intake (focusing on linoleic acid, LA) and metabolic health outcomes (diabetes, cholesterol, BMI, CVD mortality, dementia mortality) in Australia. The analysis will primarily cover 1980-present, using FAOSTAT dietary data (available from 1961) for historical context and calculating LA intake. We will leverage long-term mortality data from ABS and modelled prevalence/incidence data from IHME GBD (from 1990) for health outcomes where available. The project emphasizes rigorous data engineering to construct a time-series data asset, followed by explanatory and predictive modeling.

## Project Phases

### Phase 1: Data Collection & Initial Preparation (Largely Complete)

* **Objective** : Gather raw datasets and perform initial cleaning, standardization, and validation.
* **Tasks** :
  * [X] Scrape/acquire linoleic acid content data (Fire in a Bottle/USDA). Prepare LA content lookup table.
  * [X] Download NCD-RisC (Diabetes, Cholesterol, BMI) and FAOSTAT datasets.
  * [ ] Download ABS Causes of Death data cube (Manual Step).
  * [ ] Download IHME GBD data for Dementia & CVD (Prevalence, Incidence, Deaths rates/numbers, 1990-present) (Manual Step via VizHub tool).
  * [X] Perform initial cleaning and standardization of NCD-RisC datasets. Use Pydantic for validation where implemented.
  * [X] Generate initial data summary reports (`reports/processed_data_summary.md`).

### Phase 2: Feature Engineering & Data Asset Construction

* **Objective** : Construct the unified time-series data asset linking estimated dietary patterns (esp. LA intake) to health outcomes.
* **Tasks** :

  * [X] Verify and finalize processing of FAOSTAT data for Australia.
  * [X] Prepare a clean Linoleic Acid content lookup table (`la_food_item | linoleic_acid_g_per_100g`).
  * [X] Implement and manually validate semantic matching for FAOSTAT items -> LA content. Save validated mapping.
  * [X] Calculate Derived Dietary Metrics (Total LA Intake g/day, % Calories from LA, Plant Fat Ratio, Total Calories, Fat, Protein, Carbs). Apply methodology adjustments. Save `dietary_metrics_australia_calculated.csv`.
  * [X] Fix Total Supply Calculation by using Grand Total values from FAOSTAT directly, instead of incorrectly summing across all individual items.

  * **Process Health Outcome Data:**
    * Process **ABS Causes of Death** data cube: Filter Australia, select relevant ICD codes (Dementia/Alzheimer's, IHD, Stroke) across versions, aggregate deaths by year, calculate/extract age-standardized mortality rates (ASMR). Standardize columns. Save `abs_cod_metrics.csv`.
    * Process downloaded **IHME GBD** CSVs: Load, filter Australia, select key metrics (e.g., age-standardized prevalence/incidence/death rates/numbers for Dementia, IHD, Stroke from 1990+). Standardize columns. Save `gbd_dementia_metrics.csv`, `gbd_cvd_metrics.csv`.
    * [X] Standardize previously processed **NCD-RisC** data (Diabetes, BMI, Cholesterol).
  * **Merge Datasets:**
    * [X] Consolidate all processed health metrics (ABS CoD, GBD, NCD-RisC) into a single dataframe indexed by Year (`health_metrics_australia_combined.csv` - generated by `health_outcome_metrics.py`).
    * [X] Merge the consolidated health outcomes with the `dietary_metrics_australia_calculated.csv` dataset by `Year`. Handle missing years/data.
  * **Feature Engineering (Lags):** Create lagged versions (`_lag5`, `_lag10`, `_lag15`, `_lag20`) of `LA_Intake_percent_calories` and merge. Save final dataset as `analytical_data_australia_final.csv`.
  * [X] Perform basic validation (summary stats, missing data checks) on the final merged dataset.

### Phase 3: IHME Integration (In Progress)

* **Objective**: Integrate IHME GBD data processing and results into the main pipeline.
* **Status**:
  * [X] ETL Runner Integration: Added IHME processing to `run_etl.py` with proper error handling and data validation (Completed 28 May 2025)
  * [X] Merge Logic: Added `extract_ihme_metrics()` function to process GBD metrics and updated main function to merge with existing data (Completed 28 May 2025)
  * [ ] Data Model: Pending update to `AnalyticalRecord` model for IHME metrics
  * [ ] Documentation: Pending updates to reflect IHME integration

### Phase 4: Modeling and Analysis (In Progress)

* **Objective**: Model and analyze relationships using the final data asset.
* **Status**:
  * [X] Initial EDA completed with comprehensive summary statistics and visualisations
  * [ ] Detailed correlation and lag analyses in progress
  * [ ] MLR, GAMs, and other modeling approaches pending
* **Tasks**: 
  * Complete remaining EDA tasks
  * Implement MLR and GAMs
  * Optional: Time Series Models, Tree-Based Models
  * Interpret results, document findings and limitations (ecological fallacy, confounders, data source differences/time ranges)

### Phase 5: Visualisation and Local Demonstration (Updated 1 June 2025)

* **Objective**: Present findings effectively through an interactive web dashboard.
* **Status**:
  * [X] Interactive visualisations completed using Plotly
  * [X] Dashboard configured for local demonstration
  * [ ] Final documentation pending
* **Implementation Details**:
  * Created comprehensive interactive visualisation module (`src/visualisation/interactive.py`)
  * Implemented dashboard generator (`src/visualisation/create_dashboard.py`)
  * Added thorough test coverage (`tests/test_interactive_viz.py`)
  * Configured for local demonstration:
    * Dashboard and plots organized in `figures` directory
    * Python HTTP server for local viewing
    * Relative paths used for plot references
* **Demonstration Strategy**:
  * Using local Python HTTP server for demonstration
  * Benefits of this approach:
    * Self-contained and portable
    * No external dependencies
    * Easy to set up and demonstrate
    * Suitable for portfolio presentation
    * Maintains data privacy
* **Next Steps**:
  * Complete final documentation
  * Create presentation materials
  * Document interactive features

## Data Sources

### Metabolic Health Data (Revised)

* **Diabetes Prevalence:** NCD Risk Factor Collaboration (1980-2022) - Modelled
  * URL: [https://ncdrisc.org/downloads/dm-2024/individual-countries/NCD_RisC_Lancet_2024_Diabetes_Australia.csv](https://ncdrisc.org/downloads/dm-2024/individual-countries/NCD_RisC_Lancet_2024_Diabetes_Australia.csv)
* **Cholesterol (Total & Non-HDL):** NCD Risk Factor Collaboration (1980-2018) - Modelled
  * URL: [https://ncdrisc.org/downloads/chol/individual-countries/Australia.csv](https://ncdrisc.org/downloads/chol/individual-countries/Australia.csv)
* **Adult BMI / Obesity Prevalence:** NCD Risk Factor Collaboration (1990-2022) - Modelled
  * URL: [https://ncdrisc.org/downloads/bmi-2024/adult/by_country/NCD_RisC_Lancet_2024_BMI_age_standardised_Australia.csv](https://ncdrisc.org/downloads/bmi-2024/adult/by_country/NCD_RisC_Lancet_2024_BMI_age_standardised_Australia.csv)
  * **Note:** Integration of `BMI_AgeStandardised` column needs verification/fixing.
* **Dementia & CVD Mortality:** Australian Bureau of Statistics (ABS) Causes of Death (Approx. 1980-Present) - Official Statistics
  * **Action:** Data now downloaded automatically by the pipeline.
  * URL: [https://www.abs.gov.au/statistics/health/causes-death/causes-death-australia](https://www.abs.gov.au/statistics/health/causes-death/causes-death-australia) (Source reference)
* **Dementia & CVD Prevalence/Incidence/Deaths:** Institute for Health Metrics and Evaluation (IHME) Global Burden of Disease (GBD) (1990-Present) - Modelled Estimates
  * **Action:** **Manual Download Required.** Use GBD Results Tool to select Australia, specific causes, relevant measures (Prevalence/Incidence/Deaths Rates/Numbers), age-standardised, 1990-latest. Download a **single zip file** and place in `data/raw/`.
  * URL: [https://vizhub.healthdata.org/gbd-results/](https://vizhub.healthdata.org/gbd-results/)
* **Population Data:** Australian Bureau of Statistics (ABS) - Official Statistics
  * **Source:** ABS 'National, state and territory population' series.
  * **Action:** Download/acquire latest data file (e.g., CSV or Excel). Integrate into ETL pipeline to provide annual population figures. Add processing script `src/data_processing/process_abs_population.py`.
  * **URL:** [https://www.abs.gov.au/statistics/people/population/national-state-and-territory-population](https://www.abs.gov.au/statistics/people/population/national-state-and-territory-population) (Navigate to latest release -> Data Download)

### Dietary Data (Unchanged)

* **FAOSTAT Food Balance Sheets** (Historical & Modern)
* **Linoleic Acid Reference** (Fire in a Bottle/USDA)

## Data Integration Notes (Updated)

* Use Year as primary key for merging. Analysis period focus: 1980-present (note varying start dates for health metrics).
* Manually validate FAOSTAT -> LA content mapping.
* Calculate derived dietary metrics (% LA Cals, Plant Fat Ratio). Apply methodology adjustments.
* Process ABS CoD and IHME GBD data to get annual national-level metrics (ASMRs, prevalence rates/numbers). Standardize column names (e.g., `Dementia_Mortality_Rate_ABS`, `IHD_Prevalence_Rate_GBD`).
* Consolidate health data (NCD-RisC, ABS CoD, GBD) before merging with dietary data.
* Implemented special processing for AIHW time series sheets (S3.3, S3.5) to extract historical dementia mortality data (2009-2022) with appropriate year assignments.
* Applied strict year validation (2009-2022 only) for AIHW datasets to ensure data quality and remove implausible years from the processed output.
* Focused AIHW data processing on the most valuable data sheets:
  * Sheet S2.4 from dementia prevalence (2010-2025 projections)
  * Sheet S3.5 from dementia mortality (2009-2022)
  * Table 11 from the CVD dataset for long-term CVD mortality data (1980-2022)
* Fixed critical issue with Total Supply Calculation by modifying the calculation to use the Grand Total values from FAOSTAT directly, rather than summing across all individual items. This corrected the significantly overestimated values for Total_Calorie_Supply (from ~12,000 to ~3,000-3,200 kcal/day) and Total_Fat_Supply_g (from ~425g to ~110-112g/day).
* Verified the absence of Diabetes_Treatment_Rate_AgeStandardised in the `health_metrics_australia_combined.csv` source file.
* Fixed issue with missing Diabetes_Treatment_Rate_AgeStandardised data by improving the column detection in health_outcome_metrics.py to handle case variations and provide fallback methods for data extraction.
* **IHME Integration (Completed 29 May 2025):**
  * Integrated IHME processing into ETL pipeline (`run_etl.py` calling `process_abs_ihme_data.py`) with proper error handling for missing manual download zip file.
  * Added standardised column naming for IHME metrics (e.g., `Dementia_Prevalence_Rate_IHME`, `CVD_Incidence_Number_IHME`).
  * Implemented data validation using Pydantic models within the IHME processing step.
  * Added new `extract_ihme_metrics()` function to `health_outcome_metrics.py` to process GBD metrics.
  * Updated main function in `health_outcome_metrics.py` to merge IHME data with NCD-RisC and ABS CoD metrics.
  * Updated `AnalyticalRecord` Pydantic model in `merge_health_dietary.py` to include optional IHME fields.
* **Correlation Analysis Findings (19 April 2025):**
  * Strong positive correlations between LA intake and obesity/diabetes prevalence (r > 0.85)
  * Strong negative correlation with CVD mortality (r ≈ -0.94)
  * Lag analysis reveals strengthening correlations with longer lags for obesity
  * IHME metrics show consistent patterns with other data sources:
    - Strong correlation with CVD prevalence (r ≈ 0.76)
    - Strong correlation with dementia prevalence (r ≈ 0.72)
  * Correlations remain robust across different data sources (IHME, ABS, NCD-RisC)
  * Plant Fat Ratio and Total Fat Supply show similar correlation patterns
* **GAM Analysis Implementation (30 May 2025):**
  * Implemented comprehensive GAM analysis in `src/models/gam.py` with:
    - Pydantic-based configuration management (`GAMConfig`)
    - Cross-validation for hyperparameter selection (n_splines, smoothing parameter)
    - Automated model selection based on R² scores
    - Partial dependence plots for feature interpretation
    - Comprehensive test suite in `tests/test_gam.py`
  * Key findings from GAM analysis:
    - Non-linear relationships detected between LA intake and health outcomes
    - Improved model fit compared to linear regression for most outcomes
    - Significant non-linear effects found in lagged relationships
    - Results saved in `reports/gam_analysis_summary.csv`
  * Integration with existing analysis pipeline:
    - Uses same data preparation and validation approach
    - Consistent with project's Australian English requirements
    - Follows established logging and error handling patterns
    - Generates standardised visualisations in `figures/gam_analysis/`

### Methodology Adjustments and Assumptions (Unchanged regarding FAOSTAT/LA)

* (Keep FAOSTAT processing assumptions)
* (Keep LA content adjustments/assumptions - noting previous advice on cap/missing)
* (Keep FAOSTAT methodology change handling)
* (Keep Plant Fat classification)

## Expected Outcomes (Revised)

* A unified time-series data asset (`analytical_data_australia_final.csv`) linking Australian dietary patterns (esp. % calories from LA, etc.) to metabolic health outcomes.
  * NCD-RisC metrics (Diabetes, BMI, Cholesterol) available from ~1980.
  * ABS CoD metrics (Dementia/CVD Mortality) available from ~1980.
  * IHME GBD metrics (Dementia/CVD Prevalence/Incidence) available from 1990.
* Explanatory/Predictive Models analyzing associations, accounting for varying time ranges of outcomes:
  * Linear regression models for basic trend analysis
  * GAMs for capturing non-linear relationships and interactions
  * Optional time-series models for temporal patterns
* Comprehensive documentation, including:
  * Processing of ABS/GBD data
  * Limitations (modelled data, ICD changes)
  * Visualisations (time series, correlation heatmaps, partial dependence plots)
  * Model comparison and interpretation
* Portfolio-ready project with reproducible analysis pipeline.

## Current Status (June 2025)

### Core Project Completion
* [X] Completed data processing and integration for dietary metrics
* [X] Fixed critical issue with Total Supply Calculation
* [X] Generated final analytical dataset with correct calorie and macronutrient values
* [X] Performed initial validation of the dataset structure
* [X] Integrated IHME processing into ETL pipeline
* [X] Updated AnalyticalRecord model with IHME GBD metrics (29 May 2025)
* [X] Updated Documentation for IHME Integration
* [X] Completed initial EDA with comprehensive summary statistics and visualisations (19 April 2025)
  * Generated summary statistics for all variables and by data source
  * Created distribution plots for dietary and health variables
  * Generated time series visualisations for all key metrics
  * Produced correlation analyses and heatmaps
  * Implemented lag analysis for LA intake vs health outcomes
* [X] Completed detailed correlation and lag analyses
* [X] Implemented and validated GAM analysis with cross-validation (30 May 2025)
* [X] Implemented Time Series and Tree-Based Models (31 May 2025)
  * Enhanced ARIMA implementation with auto-parameter selection using pmdarima
  * Added Prophet model support for comparison and robust forecasting
  * Implemented Random Forest and XGBoost models with feature importance analysis
  * Added comprehensive evaluation metrics (RMSE, MAPE, R²)
  * Generated visualisations for forecasts and feature importance
  * Results saved in `reports/time_series_analysis.csv` and `reports/tree_based_analysis.csv`
* [X] Configured project for local demonstration (1 June 2025)
  * Updated documentation for local setup
  * Removed deployment configurations
  * Added interactive features guide
* [X] Completed final documentation (1 June 2025)
  * Updated README with comprehensive project overview
  * Added detailed findings summary
  * Documented local development setup
  * Created interactive dashboard user guide
  * Added acknowledgments section
* [X] Created presentation materials (1 June 2025)
  * Created comprehensive presentation in `reports/presentation.md`
  * Included key findings and methodology
  * Added local dashboard demo instructions
  * Documented conclusions and future directions
  * Prepared technical appendix

### Project Deliverables Status
✅ **Data Processing Pipeline**
- Complete ETL pipeline with validation
- Integrated all data sources
- Robust error handling
- Comprehensive documentation

✅ **Analysis & Modelling**
- Multiple modelling approaches implemented
- Cross-validation of findings
- Detailed results documentation
- Visualisation of key insights

✅ **Documentation & Presentation**
- Comprehensive README
- Interactive dashboard guide
- Technical documentation
- Presentation materials

✅ **Code Quality**
- Unit tests implemented
- Code style consistency
- Error handling
- Type hints and validation

### Future Improvement Opportunities

1. **Automation Enhancements**
   - ABS data download automation
   - Automated data updates
   - CI/CD pipeline implementation
   - Dependency version pinning

2. **Additional Analysis**
   - Subgroup analysis where data permits
   - Additional confounding variables
   - Extended time series forecasting
   - Alternative modelling approaches

3. **Infrastructure**
   - Automated testing pipeline
   - Performance optimizations
   - Enhanced error reporting
   - Monitoring and logging

4. **Documentation**
   - API documentation
   - Additional usage examples
   - Extended methodology details
   - Video demonstrations

Note: These improvements are optional and not critical for the project's core functionality or demonstration purposes.

## Model Implementation Notes (Updated 31 May 2025)

* **Time Series Models:**
  * ARIMA models automatically select optimal parameters using pmdarima
  * Prophet models handle seasonality and trend changes effectively
  * Both models provide forecasts with confidence intervals
  * Evaluation metrics include RMSE, MAPE, and R²
  * Visualisations saved in `figures/time_series_forecasts/`

* **Tree-Based Models:**
  * Random Forest and XGBoost implementations with Pydantic-based configuration
  * Feature importance analysis for understanding key predictors
  * Time-series aware cross-validation
  * Results and visualisations saved in `figures/tree_based/`
  * Comprehensive evaluation metrics for model comparison

* **Model Comparison Findings:**
  * Time series models excel at capturing temporal patterns and seasonality
  * Tree-based models provide insights into feature relationships
  * GAMs offer interpretable non-linear relationships
  * Each model type contributes unique insights to the analysis
